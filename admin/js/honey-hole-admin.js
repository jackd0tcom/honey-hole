(()=>{"use strict";var e={338:(e,t,a)=>{var l=a(795);t.H=l.createRoot,l.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},t={};function a(l){var n=t[l];if(void 0!==n)return n.exports;var o=t[l]={exports:{}};return e[l](o,o.exports,a),o.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const l=window.React;var n=a.n(l),o=a(338);const s=window.lodash,r=({onSearch:e})=>{const[t,a]=(0,l.useState)(""),n=(0,l.useCallback)((0,s.debounce)(t=>{e(t)},300),[e]);return(0,l.createElement)("div",{className:"honey-hole-search"},(0,l.createElement)("input",{type:"text",className:"honey-hole-search-input",placeholder:"Search deals...",value:t,onChange:e=>{const t=e.target.value;a(t),n(t)}}))},c=({deal:e,onUpdate:t,handleBulkToggle:a,setIsDeleting:n,bulkDeals:o})=>{const[s,r]=(0,l.useState)(!1);let c=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});const i=c.format(e.sales_price);return e.original_price>0&&Math.round((e.original_price-e.sales_price)/e.original_price*100),(0,l.createElement)("div",{className:"honey-hole-deal-card"},(0,l.createElement)("div",{className:"deal-card-header"},(0,l.createElement)("div",{className:"hh-bulk-toggle"},(0,l.createElement)("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>a(e.id)})),(0,l.createElement)("div",{className:"deal-actions"},(0,l.createElement)("a",{href:`/wp-admin/admin.php?page=honey-hole-edit-deal&id=${e.id}`,className:"button"},"Edit"),(0,l.createElement)("button",{className:"button",onClick:async()=>{if(window.confirm("Are you sure you want to delete this deal?")){r(!0),n(!0);try{console.log("Deleting deal:",e.id);const a={"X-WP-Nonce":honeyHoleAdmin.nonce,"Content-Type":"application/json"},l=await fetch(`/wp-json/honey-hole/v1/delete-post/${e.id}`,{method:"POST",headers:a,credentials:"include"});if(!l.ok){const e=await l.text();throw console.error("Delete failed:",l.status,e),new Error("Failed to delete deal")}"function"==typeof t&&t()}catch(e){console.error("Error deleting deal:",e)}finally{r(!1),n(!1)}}},disabled:s},"Delete"))),(0,l.createElement)("div",{className:"deal-image"},e.image_url?(0,l.createElement)("img",{src:e.image_url,alt:e.title,className:"deal-thumbnail-image"}):(0,l.createElement)("div",{className:"no-image"},"No Image")),(0,l.createElement)("div",{className:"deal-content"},(0,l.createElement)("h3",{className:"deal-title"},e.title),(0,l.createElement)("div",{className:"deal-pricing"},(0,l.createElement)("span",{className:"sales-price"},i),e.original_price&&(0,l.createElement)("span",{className:"original-price"},c.format(e.original_price)),e.discount_percentage&&(0,l.createElement)("span",{className:"discount"},e.discount_percentage,"% OFF")),(0,l.createElement)("div",{className:"deal-rating"},(0,l.createElement)("div",{className:"rating-stars"},[...Array(5)].map((t,a)=>(0,l.createElement)("span",{key:a,className:"star "+(a<e.rating?"filled":"")},"★"))),(0,l.createElement)("span",{className:"rating-count"},e.rating)),(0,l.createElement)("div",{className:"deal-tags"},e.tags&&e.tags.join(", ")),(0,l.createElement)("div",{className:"deal-date"},"Added: ",new Date(e.date_added).toLocaleDateString()),(0,l.createElement)("a",{href:e.product_url,target:"_blank",rel:"noopener noreferrer",className:"button affiliate-link"},"View Deal")))},i=({isConfirming:e,setIsConfirming:t,bulkDeals:a,setBulkDeals:n,setIsDeleting:o,isDeleting:s,onCancel:r})=>(0,l.createElement)(l.Fragment,null,s&&(0,l.createElement)("div",{className:"hh-deleting-overlay"},(0,l.createElement)("div",{className:"hh-deleting-spinner"},"Deleting...")),(0,l.createElement)("div",{className:"hh-confirm-wrapper"},(0,l.createElement)("p",null,"Are you sure you want to delete?"),(0,l.createElement)("button",{onClick:async()=>{try{o(!0),console.log("Deleting",a);const e={"X-WP-Nonce":honeyHoleAdmin.nonce,"Content-Type":"application/json"},l=await fetch(`/wp-json/honey-hole/v1/delete-posts?post_ids=${a}`,{method:"POST",headers:e,credentials:"include"});if(!l.ok){const e=await l.text();throw console.error("Delete failed:",l.status,e),new Error("Failed to delete deal")}n([]),t(!1),o(!1)}catch(e){console.log("Error deleting Deal",e)}}},"Delete Selected"),(0,l.createElement)("button",{onClick:()=>{n([]),t(!1),r&&r()}},"Cancel"))),d=({deals:e})=>{const[t,a]=(0,l.useState)(e),[n,o]=(0,l.useState)(!1),[s,r]=(0,l.useState)([]),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{a(e)},[e]),(0,l.useEffect)(()=>{console.log("isDeleting changed:",d),d||(console.log("Refreshing deals after deletion"),h())},[d]);const h=(0,l.useCallback)(async()=>{console.log("Fetching updated deals");try{const e=await fetch("/wp-json/honey-hole/v1/deals");if(!e.ok)throw new Error("Failed to fetch deals");const t=await e.json();a(t)}catch(e){console.error("Error refreshing deals:",e)}},[]),u=(0,l.useCallback)(e=>{if(s.includes(e.id)){const t=s.filter(t=>t!==e.id);r(t),o(t.length>0)}else r([...s,e.id]),o(!0)},[s,r,o]),g=t.reduce((e,t)=>{const a=t.categories[0]?.name||"Uncategorized";return e[a]||(e[a]=[]),e[a].push(t),e},{});return(0,l.createElement)(l.Fragment,null,n?(0,l.createElement)(i,{isConfirming:n,setIsConfirming:o,bulkDeals:s,setBulkDeals:r,isDeleting:d,setIsDeleting:m,onCancel:()=>{r([]),o(!1)}}):"",(0,l.createElement)("div",{className:"honey-hole-deals-container"},Object.entries(g).map(([e,t])=>(0,l.createElement)("div",{key:e,className:"honey-hole-category-section"},(0,l.createElement)("h2",{className:"honey-hole-category-title"},e),(0,l.createElement)("div",{className:"honey-hole-deals-grid"},t.map(e=>(0,l.createElement)(c,{key:e.id,deal:e,onUpdate:h,bulkDeals:s,setBulkDeals:r,isConfirming:n,setIsConfirming:o,handleBulkToggle:()=>u(e),isDeleting:d,setIsDeleting:m})))))))},m=()=>(0,l.createElement)("div",{className:"honey-hole-actions"},(0,l.createElement)("button",{className:"hh-add-deal-button button button-primary",onClick:()=>{window.location.href="/wp-admin/admin.php?page=honey-hole-add-deal"}},"Add Deal")),h=({categories:e,selectedCategory:t,onCategoryChange:a})=>(0,l.createElement)("div",{className:"hh-admin-filter-bar"},(0,l.createElement)("div",{className:"hh-categories"},(0,l.createElement)("button",{className:"button "+("all-deals"===t?"active":""),onClick:()=>a("all-deals")},"All Deals"),e.map(e=>(0,l.createElement)("button",{key:e.id,className:"button "+(t===e.slug?"active":""),onClick:()=>a(e.slug)},e.name)))),u=({onRefreshDeals:e})=>{const[t,a]=(0,l.useState)(!1),[n,o]=(0,l.useState)(!1);return(0,l.createElement)("div",{className:"honey-hole-delete-all-container"},(0,l.createElement)("div",{className:"honey-hole-delete-all-warning"},(0,l.createElement)("h3",null,"⚠️ Danger Zone"),(0,l.createElement)("p",null,"This action will permanently delete ALL deals from your database. This cannot be undone.")),(0,l.createElement)("button",{className:`button ${t?"button-primary":"button-secondary"} ${n?"disabled":""}`,onClick:async()=>{if(t)if(window.confirm("Are you absolutely sure you want to delete ALL deals? This action cannot be undone.")){o(!0);try{if(!(await fetch("/wp-json/honey-hole/v1/delete-posts",{method:"POST",headers:{"X-WP-Nonce":window.honeyHoleAdmin.nonce,"Content-Type":"application/json"},body:JSON.stringify({post_ids:"all"})})).ok)throw new Error("Failed to delete all deals");e&&e(),alert("All deals have been deleted successfully!")}catch(e){console.error("Error deleting all deals:",e),alert("Failed to delete all deals. Please try again.")}finally{o(!1),a(!1)}}else a(!1);else a(!0)},disabled:n},n?"Deleting...":t?"Click again to confirm":"Delete All Deals"),t&&!n&&(0,l.createElement)("button",{className:"button",onClick:()=>a(!1),style:{marginLeft:"10px"}},"Cancel"))},g=()=>{const[e,t]=(0,l.useState)([]),[a,n]=(0,l.useState)([]),[o,s]=(0,l.useState)([]),[c,i]=(0,l.useState)("all-deals"),[g,y]=(0,l.useState)(""),[p,E]=(0,l.useState)(!0),[f,w]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{E(!0);const[e,a]=await Promise.all([N(),v()]);t(e),n(e),i("all-deals"),s(a)}catch(e){w(e.message)}finally{E(!1)}})()},[]);const N=async(e="all",t="")=>{try{let a="/wp-json/honey-hole/v1/deals";const l=new URLSearchParams;"all"!==e&&l.append("category",e),t&&l.append("search",t),l.toString()&&(a+=`?${l.toString()}`);const n=await fetch(a);if(!n.ok)throw new Error("Failed to fetch deals");return await n.json()}catch(e){throw console.error("Error fetching deals:",e),e}},v=async()=>{try{const e=await fetch("/wp-json/honey-hole/v1/categories");if(!e.ok)throw new Error("Failed to fetch categories");return await e.json()}catch(e){throw console.error("Error fetching categories:",e),e}};return p?(0,l.createElement)("div",{className:"honey-hole-loading"},"Loading deals..."):f?(0,l.createElement)("div",{className:"honey-hole-error"},"Error: ",f):(0,l.createElement)("div",{className:"honey-hole-admin"},(0,l.createElement)("div",{className:"honey-hole-menu-container"},(0,l.createElement)("a",{href:"https://outdoorempire.com/thehoneyhole/",target:"_blank"},(0,l.createElement)("div",{className:"honey-hole-logo"},(0,l.createElement)("img",{src:"https://outdoorempire.com/wp-content/uploads/2025/06/the-honey-hole-font-logo.png",alt:"Honey Hole"}))),(0,l.createElement)(h,{categories:o,selectedCategory:c,onCategoryChange:async e=>{i(e);try{if("all-deals"===e)t(a);else{const l=a.filter(t=>t.categories&&t.categories.length>0&&t.categories[0].slug===e);t(l)}}catch(e){console.error("Error filtering deals:",e),w(e.message)}}}),(0,l.createElement)(r,{onSearch:async e=>{y(e);try{const a=await N(c,e);t(a)}catch(e){w(e.message)}}}),(0,l.createElement)(m,null)),(0,l.createElement)(d,{deals:e}),(0,l.createElement)(u,{onRefreshDeals:async()=>{try{const e=await N(c,g);t(e),n(e)}catch(e){w(e.message)}}}))};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("honey-hole-admin-root");e&&(0,o.H)(e).render((0,l.createElement)(n().StrictMode,null,(0,l.createElement)(g,null)))})})();